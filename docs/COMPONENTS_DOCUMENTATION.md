# LifeSync AI Coach - 组件开发文档

## 目录结构

```
components/
├── dashboard/                    # 仪表盘子组件
│   ├── FocusSection.tsx         # 专注计时器区域
│   ├── GoalsSection.tsx         # 目标和愿景区域
│   ├── RecordsSection.tsx       # 历史记录和每日复盘区域
│   └── TasksSection.tsx         # 任务和习惯区域
├── Calendar.tsx                 # 日历选择器组件
├── ChatInterface.tsx            # AI 聊天界面
├── Dashboard.tsx                # 主仪表盘布局
├── GoalDetailsModal.tsx         # 目标详情弹窗
├── HabitDetailsModal.tsx        # 习惯详情弹窗
├── MobileLayout.tsx             # 移动端布局
├── ReportDetailsModal.tsx       # 复盘详情弹窗
├── ReportEditModal.tsx          # 复盘编辑弹窗
├── SearchModal.tsx              # 全局搜索弹窗
├── Select.tsx                   # 自定义下拉选择组件
├── SessionDetailsModal.tsx      # 专注记录详情弹窗
├── SettingsView.tsx             # 设置视图
├── TaskDetailsModal.tsx         # 任务详情弹窗
├── TimePicker.tsx               # 时间选择器
├── VisionDetailsModal.tsx       # 愿景详情弹窗
├── VisionList.tsx               # 愿景列表组件
└── WeeklyTimeline.tsx           # 周时间轴视图
```

---

## 核心组件

### Dashboard.tsx
**功能说明：** 主仪表盘组件，是应用的核心视图之一

**主要功能：**
- 整合所有仪表盘子模块（专注、任务、目标、记录）
- 管理各类详情弹窗的显示状态
- 响应式网格布局，适配不同屏幕尺寸

**关键依赖：**
- `FocusSection` - 专注计时器
- `TasksSection` - 任务和习惯管理
- `GoalsSection` - 目标和愿景管理
- `RecordsSection` - 历史记录和复盘
- 各类详情弹窗组件

**状态管理：**
- 通过 `useApp` Context 获取全局状态
- 管理 `viewingTaskId`, `viewingGoalId`, `viewingVisionId` 等弹窗状态

**布局特点：**
- 使用 Grid 布局，大屏 2 列，移动端单列
- 专注区域占据全宽
- 所有区域支持垂直滚动

---

### MobileLayout.tsx
**功能说明：** 移动端专用布局组件，提供底部导航栏

**主要功能：**
- 移动端标签页切换（聊天、任务、目标、复盘、设置）
- 底部导航栏（Tab Bar）
- 管理移动端的各类弹窗

**特色功能：**
- 自动隐藏标签栏的弹窗系统
- 响应式 Tab 图标高亮
- 流畅的页面切换动画

**视图模式：**
1. **chat** - AI 教练聊天界面
2. **tasks** - 任务与习惯管理
3. **goals** - 目标与愿景管理
4. **reports** - 每日复盘
5. **settings** - 应用设置

---

## 仪表盘子组件

### dashboard/FocusSection.tsx
**功能说明：** 专注计时器组件

**主要功能：**
- 开始/结束专注计时
- 实时显示已用时间（HH:MM:SS 格式）
- 编辑当前专注记录的标签
- 自定义专注内容输入

**技术实现：**
- 使用 `setInterval` 每秒更新显示时间
- 支持内联编辑专注标签
- 自动计算从 `startTime` 到当前的时长

**UI 特点：**
- 大号 Monospace 字体显示计时
- 响应式布局（桌面端横向，移动端纵向）
- 开始按钮带主题色渐变和阴影

---

### dashboard/TasksSection.tsx
**功能说明：** 任务和习惯管理区域

**主要功能：**
- 显示未完成任务列表
- 显示每日习惯及打卡状态
- 添加新任务和新习惯
- 快速开始专注（关联任务）
- 查看任务和习惯详情

**任务功能：**
- 勾选完成任务
- 显示关联目标名称
- 删除任务
- 点击任务查看详情

**习惯功能：**
- 每日打卡（上午/下午）
- 显示连续打卡天数
- 点击习惯查看打卡日历和详情

**UI 特点：**
- Morandi 色调的完成状态视觉反馈
- 悬浮卡片效果
- 快捷操作按钮（播放、删除、打勾）

---

### dashboard/GoalsSection.tsx
**功能说明：** 目标和愿景管理区域

**主要功能：**
- 显示进行中的目标列表
- 显示活跃的愿景列表
- 添加新目标（支持设置截止日期和颜色）
- 添加新愿景
- 目标进度条显示
- 关联任务和时间统计

**目标功能：**
- 设置截止日期
- 自定义 Morandi 颜色
- 关联愿景
- 自动计算投入时间和完成进度
- 点击查看目标详情

**愿景功能：**
- 长期目标管理
- 自动统计关联目标的总投入时间
- 归档/恢复愿景
- 删除愿景

**UI 特点：**
- 环形进度条
- 倒计时天数提示
- 颜色选择器
- 愿景时间徽章

---

### dashboard/RecordsSection.tsx
**功能说明：** 历史记录和每日复盘管理区域（最复杂的子组件）

**主要功能：**

#### 1. 周时间轴视图
- 显示一周的专注记录分布
- 可拖拽调整记录的开始和结束时间
- 点击记录查看详情
- 颜色编码（任务、打卡等）

#### 2. 手动记录添加
- 选择日期和时间
- 设置时长
- 关联任务
- 添加描述

#### 3. 每日复盘管理
- 生成每日复盘（AI 自动生成）
- 查看历史复盘
- 编辑复盘内容
- 删除复盘
- Markdown 渲染

**技术亮点：**
- 集成 `WeeklyTimeline` 组件
- AI 生成加载状态管理
- 复盘临时编辑状态
- 日期导航（前一天/后一天）

**UI 特点：**
- 分页式周视图
- 实时生成状态反馈
- Markdown 样式渲染
- 精美的卡片布局

---

## 弹窗组件

### TaskDetailsModal.tsx
**功能说明：** 任务详情查看和编辑弹窗

**主要功能：**
- 查看任务详细信息
- 编辑任务标题
- 修改关联目标
- 查看任务投入时间统计
- 删除任务
- 切换完成状态

**详情展示：**
- 创建时间
- 关联目标
- 累计投入时间（来自专注记录）
- 相关专注记录列表

**编辑功能：**
- 内联编辑任务标题
- 下拉选择关联目标
- 确认删除提示

---

### GoalDetailsModal.tsx
**功能说明：** 目标详情查看和编辑弹窗

**主要功能：**
- 查看目标详细信息
- 编辑目标标题、截止日期和颜色
- 查看关联任务列表
- 查看投入时间统计
- 计算目标进度
- 删除目标

**详情展示：**
- 环形进度条
- 截止日期倒计时
- 关联任务列表及完成状态
- 累计投入时间
- 创建时间

**编辑功能：**
- 修改标题
- 修改截止日期（日历选择器）
- 修改 Morandi 颜色

---

### HabitDetailsModal.tsx
**功能说明：** 习惯详情及打卡日历弹窗

**主要功能：**
- 查看习惯详细信息
- 显示月度打卡日历
- 编辑习惯名称和类型
- 历史打卡记录
- 连续打卡天数统计
- 删除习惯

**打卡日历：**
- 月度视图
- 上午/下午打卡可视化
- 月份切换导航
- 点击日期快速打卡

**统计功能：**
- 连续打卡天数
- 总打卡次数
- 打卡类型统计

**编辑功能：**
- 修改习惯标题
- 修改习惯类型（上午/下午/全天）
- 修改 Morandi 颜色

---

### VisionDetailsModal.tsx
**功能说明：** 愿景详情及进度可视化弹窗

**主要功能：**
- 查看愿景详细信息
- GitHub 风格的投入热力图
- 编辑愿景标题
- 查看关联目标列表
- 查看关联任务列表
- 归档/删除愿景

**可视化功能：**
- 动态天数的投入热力图
- 颜色深度表示投入时长
- 按周分组显示

**统计展示：**
- 总投入时间
- 关联目标数量
- 关联任务数量
- 创建时间

**编辑功能：**
- 修改愿景标题
- 归档/恢复愿景
- 确认删除

---

### SessionDetailsModal.tsx
**功能说明：** 专注记录详情编辑弹窗

**主要功能：**
- 编辑专注记录内容
- 修改开始和结束时间
- 关联/解除任务关联
- 删除专注记录

**编辑功能：**
- 修改记录描述
- 时间选择器（`TimePicker`）
- 任务下拉选择
- 区分打卡类型和专注类型

**特殊处理：**
- 打卡记录只显示单一时间
- 专注记录显示开始和结束时间
- 自动验证时间逻辑

---

### ReportDetailsModal.tsx
**功能说明：** 每日复盘详情查看和编辑弹窗

**主要功能：**
- 查看复盘内容（Markdown 渲染）
- 编辑复盘文本
- 删除复盘
- 保存修改

**查看模式：**
- Markdown 格式渲染
- 精美的排版样式
- 滚动阅读支持

**编辑模式：**
- 大型文本域
- 实时预览（切换回查看模式）
- 保存/取消操作

---

### ReportEditModal.tsx
**功能说明：** 简化版的复盘编辑弹窗（可能用于快速编辑）

**主要功能：**
- 专注于编辑功能
- 无预览模式
- 快速保存

**使用场景：**
- 快速修改复盘内容
- 简洁的编辑界面

---

### SearchModal.tsx
**功能说明：** 全局搜索弹窗

**主要功能：**
- 搜索任务、目标、愿景、专注记录、习惯、每日复盘
- 实时过滤搜索结果
- 分类显示搜索结果
- 点击结果直接导航到对应详情

**搜索功能：**
- 模糊匹配标题和内容
- 智能分类结果
- 显示类型图标和徽章
- 结果高亮

**UI 特点：**
- 固定在顶层（z-index 高）
- 透明背景+毛玻璃效果
- 分类型展示结果
- 快速导航按钮

---

## 界面组件

### ChatInterface.tsx
**功能说明：** AI 教练聊天界面

**主要功能：**
- 显示聊天消息记录
- 发送消息给 AI
- 多会话管理
- 新建/切换/删除会话
- 智能快捷插入（任务、目标、复盘、专注）

**消息显示：**
- 用户消息和 AI 消息视觉区分
- Markdown 渲染 AI 回复
- 自动滚动到最新消息
- 加载状态指示器

**会话管理：**
- 会话列表侧边栏
- 会话标题显示
- 删除会话确认
- 新建会话

**快捷功能：**
- 快捷按钮插入任务/目标/复盘信息
- 历史记录查看
- 清空对话

---

### SettingsView.tsx
**功能说明：** 应用设置视图（最大的单文件组件）

**主要功能：**

#### 1. 通用设置
- 主题色选择
- 语言设置（未来支持多语言）
- 调试模式开关
- 数据导入/导出

#### 2. AI 教练设置
- API Key 配置
- AI 模型选择
- 教练风格选择（多种预设人格）
- 自定义提示词编辑
- 用户上下文信息
- 记忆模式开关

#### 3. 数据管理
- 导出 JSON 数据
- 导入 JSON 数据
- 清空所有数据（需确认）
- 数据备份提示

#### 4. 关于信息
- 应用版本
- 开发者信息
- 开源协议

**教练人格：**
- 专业顾问
- 友善导师
- 严格教练
- 创意伙伴
- （支持自定义）

**UI 特点：**
- 标签页布局
- 颜色选择器
- 表单验证
- 保存成功反馈

---

## 工具组件

### Calendar.tsx
**功能说明：** 日历弹出选择器组件

**主要功能：**
- 月度日历视图
- 日期选择
- 可选时间输入
- 多种显示模式（全尺寸、图标、响应式）
- 上/下弹出位置

**显示模式：**
- `full` - 完整日期文本显示
- `icon` - 仅图标
- `responsive` - 响应式（移动端图标，桌面端文本）

**弹出位置：**
- `top` - 向上弹出
- `bottom` - 向下弹出

**技术实现：**
- 点击外部自动关闭
- 支持时间选择（可选）
- 主题色集成

---

### TimePicker.tsx
**功能说明：** 时间选择器组件

**主要功能：**
- 小时和分钟双列选择
- 24 小时制
- 点击外部关闭
- 自动滚动到当前选中时间

**UI 特点：**
- 双列滚动选择器
- Monospace 字体显示
- 高亮当前选中值
- 平滑滚动

---

### Select.tsx
**功能说明：** 自定义下拉选择组件

**主要功能：**
- 替代浏览器原生 `<select>`
- 主题色集成
- 下拉动画
- 自动滚动到选中项

**UI 特点：**
- 精美的展开动画
- 勾选图标
- 主题色高亮
- 悬浮阴影效果

---

### VisionList.tsx
**功能说明：** 愿景列表展示组件

**主要功能：**
- 显示活跃和已归档愿景
- 添加新愿景
- 归档/恢复愿景
- 删除愿景
- 查看愿景详情
- 统计愿景投入时间

**排序逻辑：**
- 活跃愿景优先
- 按创建时间倒序

**UI 特点：**
- 卡片式布局
- 悬浮效果
- 归档状态视觉区分
- 时间徽章

---

### WeeklyTimeline.tsx
**功能说明：** 周时间轴可视化组件

**主要功能：**
- 显示一周的专注记录
- 24 小时时间轴
- 拖拽调整记录时长
- 颜色编码任务类型
- 点击查看记录详情

**交互功能：**
- 拖拽顶部边缘调整开始时间
- 拖拽底部边缘调整结束时间
- 拖拽整体移动记录
- 鼠标悬浮显示详情

**可视化：**
- 任务关联颜色
- 目标颜色传递
- 时间块高度表示时长
- 响应式布局

**技术实现：**
- 复杂的拖拽逻辑
- 时间坐标转换
- 碰撞检测
- 全局鼠标事件监听

---

## 组件依赖关系

```
App
├── MobileLayout (移动端)
│   ├── ChatInterface
│   ├── TasksSection
│   ├── GoalsSection
│   ├── RecordsSection (包含 WeeklyTimeline)
│   ├── SettingsView
│   └── 各类 DetailModal
│
└── Dashboard (桌面端)
    ├── FocusSection
    ├── TasksSection
    ├── GoalsSection
    ├── RecordsSection
    └── 各类 DetailModal

工具组件（被多处使用）：
- Calendar
- TimePicker
- Select
- SearchModal
```

---

## 主题系统

所有组件都支持通过 `theme` prop 接收主题配置：

```typescript
interface ThemeConfig {
  primary: string;  // 主题色，如 'indigo', 'blue', 'purple'
}
```

组件内使用 Tailwind 动态类名：
```javascript
className={`bg-${theme.primary}-600 text-white`}
```

---

## 状态管理

组件依赖的全局状态通过 `useApp` Context 提供：

**主要状态：**
- `tasks` - 任务列表
- `goals` - 目标列表
- `visions` - 愿景列表
- `habits` - 习惯列表
- `sessions` - 专注记录列表
- `reports` - 每日复盘列表
- `activeSessionId` - 当前活跃专注记录 ID

**主要 Actions：**
- `addTask`, `updateTask`, `deleteTask`, `toggleTask`
- `addGoal`, `updateGoal`, `deleteGoal`, `toggleGoal`
- `addVision`, `updateVision`, `deleteVision`, `toggleVisionArchived`
- `addHabit`, `updateHabit`, `deleteHabit`, `toggleCheckIn`
- `startSession`, `stopSession`, `addSession`, `updateSession`, `deleteSession`
- `generateReport`, `saveReport`, `updateReport`, `deleteReport`

---

## 样式规范

### 颜色方案
- **Morandi 色系：** 各组件中定义的 `MORANDI_COLORS` 数组
  - Warm Beige: `#e8d3c0`
  - Warm Brown/Orange: `#d89c7a`
  - Warm Yellow: `#d6c38b`
  - Greyish Green: `#849b91`
  - Cool Grey/Blue: `#c2cedc`
  - Cool Grey/Purple: `#686789`

### 圆角规范
- 小组件/按钮：`rounded-lg` (8px)
- 卡片：`rounded-2xl` (16px)
- 大型模态框：`rounded-3xl` (24px)

### 阴影规范
- 悬浮卡片：`shadow-float`
- 主操作按钮：`shadow-lg shadow-${theme.primary}-200`
- 弹窗：`shadow-2xl`

### 间距规范
- 卡片内边距：`p-4` 至 `p-8`
- 元素间距：`gap-2` 至 `gap-8`
- 区域间距：`space-y-4` 至 `space-y-8`

---

## 动画效果

组件中广泛使用的动画：
- `transition-all` - 通用过渡
- `transition-colors` - 颜色过渡
- `hover:shadow-md` - 悬浮阴影
- `animate-in fade-in zoom-in-95` - 弹窗出现动画
- `group-hover` - 组内联动动画

---

## 响应式设计

### 断点使用
- `md:` - 中等屏幕（桌面）
- `lg:` - 大屏幕
- 移动端优先设计

### 布局适配
- Grid 布局：`grid-cols-1 lg:grid-cols-2`
- Flex 布局：`flex-col md:flex-row`
- 隐藏/显示：移动端使用 `MobileLayout`，桌面使用 `Dashboard`

---

## 无障碍设计

- 所有按钮有 `title` 属性
- 语义化 HTML 标签
- 足够的点击区域（最小 `p-2`）
- 键盘操作支持（部分组件）

---

## 性能优化

- 使用 `useMemo` 缓存计算结果
- 避免不必要的重渲染
- 大列表使用虚拟滚动（待优化）
- 懒加载模态框组件

---

## 开发建议

### 新增组件
1. 遵循现有命名约定（PascalCase）
2. 使用 TypeScript 定义 Props 接口
3. 集成 `theme` prop
4. 添加适当的注释

### 修改组件
1. 保持向后兼容
2. 更新相关文档
3. 测试多种设备尺寸
4. 验证数据流

### 样式一致性
1. 使用项目定义的颜色变量
2. 遵循圆角和阴影规范
3. 保持间距一致性
4. 测试暗色模式兼容性（待实现）

---

## 未来改进方向

1. **组件库化：** 抽取通用组件到独立包
2. **测试覆盖：** 添加单元测试和集成测试
3. **Storybook：** 建立组件展示和文档系统
4. **性能监控：** 添加性能分析工具
5. **暗色模式：** 完整支持暗色主题
6. **国际化：** 多语言支持
7. **虚拟滚动：** 优化大数据列表性能

---

## 常见问题

### Q: 为什么有两个 ReportModal？
A: `ReportDetailsModal` 用于查看和编辑，`ReportEditModal` 可能用于快速编辑场景，功能有重叠。

### Q: 组件如何访问全局状态？
A: 通过 `useApp` Hook 访问 Context 提供的状态和 Actions。

### Q: 如何添加新的 Morandi 颜色？
A: 在组件内的 `MORANDI_COLORS` 数组中添加，保持色系一致。

### Q: Modal 的 z-index 如何管理？
A: 一般用 `z-50` 或 `z-[60]`，SearchModal 使用更高层级。

---

## 更新日志

- **2025-11:** 创建组件开发文档
- **2025-11:** 完善所有组件功能说明

---

**文档维护者：** AI Assistant  
**最后更新：** 2025-11-30  
**版本：** 1.0.0
